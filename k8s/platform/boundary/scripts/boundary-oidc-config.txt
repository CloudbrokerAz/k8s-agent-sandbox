==========================================
  Boundary OIDC Configuration
==========================================

Auth Method ID:     amoidc_dd9zaQBEM8
Issuer:             https://keycloak.local/realms/agent-sandbox
Client ID:          boundary

==========================================
  Managed Groups
==========================================

Admins Group:         ✅ Managed group 'keycloak-admins' already exists (mgoidc_K0MQoI37ZD)
mgoidc_K0MQoI37ZD
Developers Group:     ✅ Managed group 'keycloak-developers' already exists (mgoidc_6YX5A8hQhD)
mgoidc_6YX5A8hQhD
Readonly Group:       ✅ Managed group 'keycloak-readonly' already exists (mgoidc_KI0QbGDLZi)
mgoidc_KI0QbGDLZi

==========================================
  Group Mappings
==========================================

Keycloak Group      → Boundary Access
-----------------------------------------
admins              → Full access (all operations)
developers          → Connect access (read + authorize-session on targets)
readonly            → List access (read + list on all resources)

==========================================
  Keycloak Configuration Required
==========================================

1. Keycloak client configuration (auto-configured by this script):
   - Realm: agent-sandbox
   - Client ID: boundary
   - Client Protocol: openid-connect
   - Access Type: confidential
   - Valid Redirect URIs:
     * https://boundary.local/v1/auth-methods/oidc:authenticate:callback (via ingress)
     * http://127.0.0.1:9200/v1/auth-methods/oidc:authenticate:callback (port-forward)
     * http://localhost:9200/v1/auth-methods/oidc:authenticate:callback (port-forward)

2. Configure client scopes to include 'groups' claim

3. Create groups in Keycloak:
   - admins
   - developers
   - readonly

4. Assign users to groups

==========================================
  Usage
==========================================

1. Port forward to Boundary API:
   kubectl port-forward -n boundary svc/boundary-controller-api 9200:9200

2. Authenticate with OIDC:
   export BOUNDARY_ADDR=http://127.0.0.1:9200
   boundary authenticate oidc -auth-method-id=amoidc_dd9zaQBEM8

3. Your browser will open for Keycloak login
   - Login with Keycloak credentials
   - You'll be redirected back to Boundary

4. Connect to targets based on your group membership

==========================================
  Testing OIDC Auth
==========================================

Run the test script:
  ./test-oidc-auth.sh

