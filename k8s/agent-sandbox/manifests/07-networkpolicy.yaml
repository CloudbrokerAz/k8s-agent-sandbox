# NetworkPolicy for isolating dev environments
# Note: Requires a network plugin that supports NetworkPolicy (Calico, Cilium, etc.)
# Kind with default CNI may not enforce this

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: devenv-isolation
  namespace: devenv
spec:
  podSelector:
    matchLabels:
      app: devenv
  policyTypes:
  - Ingress
  - Egress

  # Allow ingress from within the namespace
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: devenv
    - podSelector: {}

  # Allow egress to:
  # - DNS (kube-dns/CoreDNS)
  # - External internet (for package downloads, git, etc.)
  # - Other pods in the namespace
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53
  - to:
    - namespaceSelector: {}
  - to:
    - podSelector: {}
